<!DOCTYPE HTML>
<html>
<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">

    
    
        
    
    
    <title>node-libspotify - Flo.by</title>
    <!-- bootstrap -->
    <link rel="stylesheet" href="http://projects.flo.by/node-libspotify/bootstrap/css/bootstrap.css" type="text/css" media="screen" charset="utf-8">
    <link rel="stylesheet" href="http://projects.flo.by/node-libspotify/css/style.css" type="text/css" media="screen" charset="utf-8">
    <link rel="stylesheet" href="http://projects.flo.by/node-libspotify/css/pygments_style.css" type="text/css" media="screen" charset="utf-8">
    <script type="text/javascript">
      var _gaq = _gaq || [];
    </script>
</head>

<body>
    
        
    
    <div class="head">
        <div class="container">
        	<div class="row">
        		<div class="span12">
                    <p><em>This website is still under construction. Be advised!</em></p>
                </div>
        	</div>
        </div>
    </div>
    <div class="container banner">
        <div class="row">
            <div class="span2">
                <h1 class="floby-primary"><a href="http://www.flo.by/">Flo.by</a></h1>
            </div>
            <div class="span4 project">
                
                <h3 class="muted">node-libspotify</h3>
                
            </div>
            <div class="span6">
                
                
                    
                
                
                <ul class="nav nav-pills menu">
                    
                        <li class=""><a href="http://www.flo.by/">Home</a></li>
                    
                    
                        <li class="active"><a href="http://projects.flo.by/">Projects</a></li>
                    
                    <li class="disabled"><a rel="comingsoon" href="#">Work</a></li>
                    
                        <li><a target="_blank" onclick="javascript:_gaq.push(['_trackPageview', '/resume.pdf']);" href="http://www.flo.by/files/Florent-Jaby-CV.pdf">Resume</a></li>
                    
                </ul>
            </div>
        </div>
    </div><!-- .banner -->

    <div class="main">
         <div class="container">
    <div class="row">
        <hr />
        <div class="span8">
            <ul class="nav nav-tabs">
    
        
            <li><a href="http://projects.flo.by/node-libspotify/">Home</a></li>
        
    
        
            <li><a href="http://projects.flo.by/node-libspotify/download">Download</a></li>
        
    
        
            <li><a href="http://projects.flo.by/node-libspotify/quick-start">Quick Start</a></li>
        
    
        
            <li class="active"><a href="http://projects.flo.by/node-libspotify/readme">Read me</a></li>
        
    
</ul>

            <p>Node bindings for the libspotify C library</p>

<p><em>This is still very alpha, but you can already play around I suppose</em></p>

<h4>Install &amp; test</h4>

<p>Please note that you must have the libspotify library installed on your system
you can get it from <a href="https://developer.spotify.com/technologies/libspotify/">here</a>.</p>

<p>You must provide your own spotify application key, because I&#39;m not giving mine away :]
You also must provide valid credentials for a spotify account.</p>

<p>Once you cloned the repository
run <code>npm install</code> then test the module with <code>npm test</code></p>

<h4>Main objectives</h4>

<p>As there are already a number of spotify bindings or modules for the REST API, the main goal
of this module is not to give access to the artist and tracks catalog. It&#39;s main purpose is
to allow for playback of the tracks. The idea is to expose a <code>Player</code> object in which the user
can load tracks, play them, and get decompressed audio data from it (as provided by the libspotify C library).</p>

<p>What the user can do with the audio stream is up to him/her. As it is raw PCM data, it is easy to pipe to
some kind of encoder (like gstreamer) in order to broadcast music or stream it to a web user (as long as it complies
with the Spotify terms of service ;).</p>

<p>The user can also choose to play the song locally with a node module like <a href="https://github.com/joeferner/node-portaudio">node-portaudio</a>
or pipe the audio data to another process like <a href="http://linux.about.com/library/cmd/blcmdl1_play.htm">play</a></p>

<p>The main goal is now achieved. Audio data is exposed as the Player object which behaves like a readable stream</p>

<h4>Snippet</h4>

<p>Here is a code snippet of how to play a track from spotify</p>
<div class="highlight"><pre><code class="javascript"><span class="kd">var</span> <span class="nx">sp</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;../lib/libspotify&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">cred</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;../spotify_key/passwd&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;fs&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">spawn</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;child_process&#39;</span><span class="p">).</span><span class="nx">spawn</span><span class="p">;</span>

<span class="kd">var</span> <span class="nx">f</span> <span class="o">=</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">createWriteStream</span><span class="p">(</span><span class="s1">&#39;/tmp/bidule.raw&#39;</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">session</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">sp</span><span class="p">.</span><span class="nx">Session</span><span class="p">({</span>
    <span class="nx">applicationKey</span><span class="o">:</span> <span class="nx">__dirname</span> <span class="o">+</span> <span class="s1">&#39;/../spotify_key/spotify_appkey.key&#39;</span>
<span class="p">});</span>
<span class="nx">session</span><span class="p">.</span><span class="nx">login</span><span class="p">(</span><span class="nx">cred</span><span class="p">.</span><span class="nx">login</span><span class="p">,</span> <span class="nx">cred</span><span class="p">.</span><span class="nx">password</span><span class="p">);</span>
<span class="nx">session</span><span class="p">.</span><span class="nx">once</span><span class="p">(</span><span class="s1">&#39;login&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="k">this</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="nx">err</span><span class="p">);</span>

    <span class="kd">var</span> <span class="nx">search</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">sp</span><span class="p">.</span><span class="nx">Search</span><span class="p">(</span><span class="s1">&#39;artist:&quot;rick astley&quot; track:&quot;never gonna give you up&quot;&#39;</span><span class="p">);</span>
    <span class="nx">search</span><span class="p">.</span><span class="nx">trackCount</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="c1">// we&#39;re only interested in the first result;</span>
    <span class="nx">search</span><span class="p">.</span><span class="nx">execute</span><span class="p">();</span>
    <span class="nx">search</span><span class="p">.</span><span class="nx">once</span><span class="p">(</span><span class="s1">&#39;ready&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">search</span><span class="p">.</span><span class="nx">tracks</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s1">&#39;there is no track to play :[&#39;</span><span class="p">);</span>
            <span class="nx">session</span><span class="p">.</span><span class="nx">logout</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="kd">var</span> <span class="nx">track</span> <span class="o">=</span> <span class="nx">search</span><span class="p">.</span><span class="nx">tracks</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
        <span class="kd">var</span> <span class="nx">player</span> <span class="o">=</span> <span class="nx">session</span><span class="p">.</span><span class="nx">getPlayer</span><span class="p">();</span>
        <span class="nx">player</span><span class="p">.</span><span class="nx">load</span><span class="p">(</span><span class="nx">track</span><span class="p">);</span>
        <span class="nx">player</span><span class="p">.</span><span class="nx">play</span><span class="p">();</span>

        <span class="c1">// linux</span>
        <span class="kd">var</span> <span class="nx">play</span> <span class="o">=</span> <span class="nx">spawn</span><span class="p">(</span><span class="s1">&#39;aplay&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;-c&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;-f&#39;</span><span class="p">,</span> <span class="s1">&#39;S16_LE&#39;</span><span class="p">,</span> <span class="s1">&#39;-r&#39;</span><span class="p">,</span> <span class="s1">&#39;44100&#39;</span><span class="p">]);</span>
        <span class="c1">// osx with `brew install sox`</span>
        <span class="kd">var</span> <span class="nx">play</span> <span class="o">=</span> <span class="nx">spawn</span><span class="p">(</span><span class="s1">&#39;play&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;-r&#39;</span><span class="p">,</span> <span class="mi">44100</span><span class="p">,</span> <span class="s1">&#39;-b&#39;</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="s1">&#39;-L&#39;</span><span class="p">,</span> <span class="s1">&#39;-c&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;-e&#39;</span><span class="p">,</span> <span class="s1">&#39;signed-integer&#39;</span><span class="p">,</span> <span class="s1">&#39;-t&#39;</span><span class="p">,</span> <span class="s1">&#39;raw&#39;</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">]);</span>

        <span class="nx">player</span><span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">play</span><span class="p">.</span><span class="nx">stdin</span><span class="p">);</span>

        <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s1">&#39;playing track. end in %s&#39;</span><span class="p">,</span> <span class="nx">track</span><span class="p">.</span><span class="nx">humanDuration</span><span class="p">);</span>
        <span class="nx">player</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">buffer</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// buffer.length</span>
            <span class="c1">// buffer.rate</span>
            <span class="c1">// buffer.channels</span>
            <span class="c1">// 16bit samples</span>
        <span class="p">});</span>
        <span class="nx">player</span><span class="p">.</span><span class="nx">once</span><span class="p">(</span><span class="s1">&#39;track-end&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s1">&#39;track ended&#39;</span><span class="p">);</span>
            <span class="nx">f</span><span class="p">.</span><span class="nx">end</span><span class="p">();</span>
            <span class="nx">player</span><span class="p">.</span><span class="nx">stop</span><span class="p">();</span>
            <span class="nx">session</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span>
        <span class="p">});</span>
    <span class="p">});</span>
<span class="p">});</span>
</code></pre></div>
<h4>TODO</h4>

<ul>
<li>Bind to the rest of the API...</li>
</ul>

        </div>
        <div class="span2 offset2 ">
            <img src="http://projects.flo.by/node-libspotify/images/node-libspotify-icon.png" />
        </div>
    </div>
</iiv>

    </div>
    <div class="container footer">
        <hr />
        <div class="row">
            <div class="span3 aknowledgement">
                <em>Website created using <a href="http://twitter.github.com/bootstrap">Twitter Bootstrap</a></em>
            </div>
            <div class="span2 offset4">
                
                <i>Last updated: 26 Jan 2013</i>
                
            </div>
            <div class="span3 copyright">
                <em>Copyright Â© 2013 Florent Jaby</em>
            </div>
        </div>
    </div><!-- .footer -->
    <script type="text/javascript" charset="utf-8" src="http://code.jquery.com/jquery-latest.js"></script>
    <script type="text/javascript" charset="utf-8" src="http://projects.flo.by/node-libspotify/bootstrap/js/bootstrap.js"></script>
    <script type="text/javascript" charset="utf-8" src="http://projects.flo.by/node-libspotify/js/prefixfree.min.js"></script>
    <script type="text/javascript" charset="utf-8">
        $('[rel=tooltip]').tooltip();
        $('[rel=comingsoon]').tooltip({
            title: 'Coming soon!',
            placement: 'bottom'
        });
        $(function() {
            setTimeout(function() {
                $(document.body).addClass('loaded');
            }, 100);
        })
    </script>

<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-37756010-1']);
  _gaq.push(['_setDomainName', window.location.hostname]);

  if(window._flobyVirtualPageName) {
      _gaq.push(['_trackPageview', window._flobyVirtualPageName]);
  }
  else {
      _gaq.push(['_trackPageview']);
  }

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
</body>

</html>

